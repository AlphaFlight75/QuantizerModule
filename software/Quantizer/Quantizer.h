/*
 * Quantizer library
 * Rich Holmes
 * 
 * Based on:
 * =======
 * TELEXo Eurorack Module
 * (c) 2016 Brendon Cassidy
 * MIT License
 * =======
 *
 * Mods include:
 * Get rid of frequency stuff, we don't need it. Can always calculate it
 * from Value anyway.
 *
 * Use avr/pgmspace to put scale data in program space, saving
 * dynamic memory.
 *
 */
 
#ifndef Quantizer_h
#define Quantizer_h

#include "Arduino.h"
#include <avr/pgmspace.h>

#define DACTOP 4095   // limit of DAC (2**12-1)
#define DAC1   4095   // DAC counts corresponding to defined voltage
#define V1     5.0    // voltage corresponding to DAC1
#define DACPEROCTAVE  (DAC1/V1)  // DAC counts per octave

struct QuantizeResponse {
  int Note; 
  int Value;
};

/*
 * Quantizes values 0-4095 to various tuning systems
 * some of this class is auto-generated by the associated python scripts
 */
class Quantizer
{
  public:

    Quantizer();
    Quantizer(int scale);
    QuantizeResponse Quantize(int in);
    void SetScale(int scale);
    float GetValueForNote(int note);

    // Bank and scale stuff
    Quantizer(int bank, int scale);
    void SetScale(int bank, int scale);

  protected:

    static const int PROGMEM bankandscale[6][12]; // index from bank-and-scale to scale

    // INSERT AUTOGENERATED SCALE HEADER DATA HERE
const static int scaleCount = 66;
static const int *hints[66];
static const float *scales[66];
static const int notecount[66];

static const float PROGMEM scale0[62];
static const int PROGMEM hints0[62];
static const float PROGMEM scale1[37];
static const int PROGMEM hints1[37];
static const float PROGMEM scale2[37];
static const int PROGMEM hints2[37];
static const float PROGMEM scale3[37];
static const int PROGMEM hints3[37];
static const float PROGMEM scale4[27];
static const int PROGMEM hints4[27];
static const float PROGMEM scale5[27];
static const int PROGMEM hints5[27];
static const float PROGMEM scale6[32];
static const int PROGMEM hints6[32];
static const float PROGMEM scale7[7];
static const int PROGMEM hints7[7];
static const float PROGMEM scale8[12];
static const int PROGMEM hints8[12];
static const float PROGMEM scale9[17];
static const int PROGMEM hints9[17];
static const float PROGMEM scale10[22];
static const int PROGMEM hints10[22];
static const float PROGMEM scale11[27];
static const int PROGMEM hints11[27];
static const float PROGMEM scale12[32];
static const int PROGMEM hints12[32];
static const float PROGMEM scale13[37];
static const int PROGMEM hints13[37];
static const float PROGMEM scale14[42];
static const int PROGMEM hints14[42];
static const float PROGMEM scale15[47];
static const int PROGMEM hints15[47];
static const float PROGMEM scale16[52];
static const int PROGMEM hints16[52];
static const float PROGMEM scale17[57];
static const int PROGMEM hints17[57];
static const float PROGMEM scale18[67];
static const int PROGMEM hints18[67];
static const float PROGMEM scale19[72];
static const int PROGMEM hints19[72];
static const float PROGMEM scale20[77];
static const int PROGMEM hints20[77];
static const float PROGMEM scale21[82];
static const int PROGMEM hints21[82];
static const float PROGMEM scale22[87];
static const int PROGMEM hints22[87];
static const float PROGMEM scale23[92];
static const int PROGMEM hints23[92];
static const float PROGMEM scale24[97];
static const int PROGMEM hints24[97];
static const float PROGMEM scale25[102];
static const int PROGMEM hints25[102];
static const float PROGMEM scale26[107];
static const int PROGMEM hints26[107];
static const float PROGMEM scale27[112];
static const int PROGMEM hints27[112];
static const float PROGMEM scale28[117];
static const int PROGMEM hints28[117];
static const float PROGMEM scale29[122];
static const int PROGMEM hints29[122];
static const float PROGMEM scale30[17];
static const int PROGMEM hints30[17];
static const float PROGMEM scale31[17];
static const int PROGMEM hints31[17];
static const float PROGMEM scale32[22];
static const int PROGMEM hints32[22];
static const float PROGMEM scale33[37];
static const int PROGMEM hints33[37];
static const float PROGMEM scale34[62];
static const int PROGMEM hints34[62];
static const float PROGMEM scale35[37];
static const int PROGMEM hints35[37];
static const float PROGMEM scale36[67];
static const int PROGMEM hints36[67];
static const float PROGMEM scale37[217];
static const int PROGMEM hints37[217];
static const float PROGMEM scale38[27];
static const int PROGMEM hints38[27];
static const float PROGMEM scale39[37];
static const int PROGMEM hints39[37];
static const float PROGMEM scale40[62];
static const int PROGMEM hints40[62];
static const float PROGMEM scale41[87];
static const int PROGMEM hints41[87];
static const float PROGMEM scale42[27];
static const int PROGMEM hints42[27];
static const float PROGMEM scale43[37];
static const int PROGMEM hints43[37];
static const float PROGMEM scale44[62];
static const int PROGMEM hints44[62];
static const float PROGMEM scale45[97];
static const int PROGMEM hints45[97];
static const float PROGMEM scale46[157];
static const int PROGMEM hints46[157];
static const float PROGMEM scale47[27];
static const int PROGMEM hints47[27];
static const float PROGMEM scale48[37];
static const int PROGMEM hints48[37];
static const float PROGMEM scale49[62];
static const int PROGMEM hints49[62];
static const float PROGMEM scale50[97];
static const int PROGMEM hints50[97];
static const float PROGMEM scale51[27];
static const int PROGMEM hints51[27];
static const float PROGMEM scale52[37];
static const int PROGMEM hints52[37];
static const float PROGMEM scale53[62];
static const int PROGMEM hints53[62];
static const float PROGMEM scale54[62];
static const int PROGMEM hints54[62];
static const float PROGMEM scale55[62];
static const int PROGMEM hints55[62];
static const float PROGMEM scale56[62];
static const int PROGMEM hints56[62];
static const float PROGMEM scale57[62];
static const int PROGMEM hints57[62];
static const float PROGMEM scale58[62];
static const int PROGMEM hints58[62];
static const float PROGMEM scale59[62];
static const int PROGMEM hints59[62];
static const float PROGMEM scale60[62];
static const int PROGMEM hints60[62];
static const float PROGMEM scale61[62];
static const int PROGMEM hints61[62];
static const float PROGMEM scale62[62];
static const int PROGMEM hints62[62];
static const float PROGMEM scale63[62];
static const int PROGMEM hints63[62];
static const float PROGMEM scale64[62];
static const int PROGMEM hints64[62];
static const float PROGMEM scale65[62];
static const int PROGMEM hints65[62];
    // END AUTOGENERATED SCALE HEADER DATA
      
  private:
    
    int _scale;
    int _octave;
    int _index;
    int _nudge;
    int _above;
    int _below;
    int _current;
    QuantizeResponse _last;

    int _temp;

};

#endif

